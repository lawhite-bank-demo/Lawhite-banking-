<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0d2f66;
  color:white;
  text-align:center;
}
.container{ padding:20px; }

.card{
  background:white;
  color:black;
  padding:20px;
  border-radius:12px;
  margin-top:20px;
}

input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}

button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
}

.green{background:#2ecc71;color:white;}
.red{background:#e74c3c;color:white;}
.blue{background:#3498db;color:white;}

.tx{
  text-align:left;
  border-bottom:1px solid #ddd;
  padding:8px 0;
}

.hidden{display:none;}
</style>
</head>

<body>

<div class="container">

<h2 id="welcome"></h2>

<div class="card">
  <h3>Your Balance</h3>
  <h1 id="balance"></h1>
</div>

<!-- DEPOSIT & WITHDRAW -->
<div class="card">
  <h3>Deposit / Withdraw</h3>
  <input id="moneyAmount" type="number" placeholder="Amount">
  <button class="green" onclick="deposit()">Deposit</button>
  <button class="red" onclick="withdraw()">Withdraw</button>
  <div id="moneyMsg"></div>
</div>

<!-- TRANSFER -->
<div class="card">
  <h3>Transfer Money</h3>
  <input id="receiver" placeholder="Receiver Username">
  <input id="amount" type="number" placeholder="Amount">
  <button class="green" onclick="transferMoney()">Send</button>
  <div id="transferMsg"></div>
</div>

<!-- HISTORY -->
<div class="card">
  <h3>Transaction History</h3>
  <div id="history"></div>
</div>

<button class="red" onclick="logout()">Logout</button>

</div>

<script>
let currentUser = JSON.parse(localStorage.getItem("currentUser"));
if(!currentUser){ window.location.href="index.html"; }

document.getElementById("welcome").innerText =
  "Welcome, " + currentUser.username;

function updateBalance(){
  document.getElementById("balance").innerText =
    "$" + currentUser.balance.toFixed(2);
}
updateBalance();

// SAVE TRANSACTION
function saveTransaction(type, amount, other=""){
  let history = JSON.parse(localStorage.getItem("transactions")) || [];
  history.push({
    user: currentUser.username,
    type,
    amount,
    other,
    date: new Date().toLocaleString()
  });
  localStorage.setItem("transactions", JSON.stringify(history));
}

// LOAD HISTORY
function loadHistory(){
  let history = JSON.parse(localStorage.getItem("transactions")) || [];
  let userTx = history.filter(tx => tx.user === currentUser.username);

  historyDiv.innerHTML = userTx.reverse().map(tx =>
    `<div class="tx">
      ${tx.type} $${tx.amount} ${tx.other}
      <br><small>${tx.date}</small>
    </div>`
  ).join("") || "No transactions yet";
}

let historyDiv = document.getElementById("history");
loadHistory();

// DEPOSIT
function deposit(){
  let amount = parseFloat(document.getElementById("moneyAmount").value);
  if(isNaN(amount) || amount <= 0) return;

  currentUser.balance += amount;

  updateStorage();
  saveTransaction("Deposited", amount);
  loadHistory();

  moneyMsg.innerText="Deposit successful";
}

// WITHDRAW
function withdraw(){
  let amount = parseFloat(document.getElementById("moneyAmount").value);
  if(isNaN(amount) || amount <= 0) return;

  if(currentUser.balance < amount){
    moneyMsg.innerText="Insufficient funds";
    return;
  }

  currentUser.balance -= amount;

  updateStorage();
  saveTransaction("Withdrew", amount);
  loadHistory();

  moneyMsg.innerText="Withdrawal successful";
}

// TRANSFER
function transferMoney(){
  let name = receiver.value.trim();
  let amount = parseFloat(document.getElementById("amount").value);

  let users = JSON.parse(localStorage.getItem("users"));

  let sender = users.find(u => u.username === currentUser.username);
  let receiverUser = users.find(u => u.username === name);

  if(!receiverUser){ transferMsg.innerText="User not found"; return; }
  if(sender.balance < amount){ transferMsg.innerText="Insufficient funds"; return; }

  sender.balance -= amount;
  receiverUser.balance += amount;

  localStorage.setItem("users", JSON.stringify(users));

  currentUser = sender;
  localStorage.setItem("currentUser", JSON.stringify(sender));

  updateBalance();
  saveTransaction("Sent", amount, "to " + name);
  loadHistory();

  transferMsg.innerText="Transfer successful";
}

function updateStorage(){
  let users = JSON.parse(localStorage.getItem("users"));
  let user = users.find(u => u.username === currentUser.username);
  user.balance = currentUser.balance;
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
  updateBalance();
}

function logout(){
  localStorage.removeItem("currentUser");
  window.location.href="index.html";
}
</script>

</body>
</html>