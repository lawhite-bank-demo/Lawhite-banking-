<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DeChase Finance Dashboard</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0b0f14;
  color:white;
}

.header{
  text-align:center;
  padding:20px 10px 5px;
}

.bank-name{
  font-size:22px;
  font-weight:bold;
}

.welcome{
  color:#9aa4b2;
  margin-top:4px;
}

.card{
  background:#151b23;
  margin:15px;
  padding:20px;
  border-radius:14px;
  text-align:center;
}

.balance{
  font-size:34px;
  margin-top:10px;
  font-weight:bold;
}

button{
  width:100%;
  padding:14px;
  margin-top:12px;
  border-radius:10px;
  border:none;
  background:#2dd4bf;
  font-weight:bold;
  cursor:pointer;
}

.transfer{
  display:none;
  margin-top:15px;
}

input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:none;
}

.tx{
  background:#0f1720;
  margin-top:8px;
  padding:10px;
  border-radius:8px;
  text-align:left;
}

small{color:#9aa4b2;}
</style>
</head>

<body>

<div class="header">
  <div class="bank-name">DeChase Finance</div>
  <div class="welcome" id="welcome"></div>
</div>

<div class="card">
  <div>Available Balance</div>
  <div class="balance" id="balance"></div>

  <button onclick="toggleSend()">Send Money</button>
  <button onclick="showHistory()">Transactions</button>

  <div class="transfer" id="sendBox">
    <input id="recipient" placeholder="Recipient name">
    <input id="amount" type="number" placeholder="Amount (€)">
    <input id="date" type="date">
    <button onclick="sendMoney()">Confirm Transfer</button>
  </div>

  <div id="history"></div>

  <button onclick="logout()">Logout</button>
</div>

<script>
// get logged in user
const currentUser = localStorage.getItem("currentUser");

// redirect if not logged in
if(!currentUser){
  window.location.href="index.html";
}

// capitalize first letter
const name =
currentUser.charAt(0).toUpperCase() + currentUser.slice(1);

// display welcome message
document.getElementById("welcome").innerText =
"Welcome, " + name;

// load users & find current user
let users = JSON.parse(localStorage.getItem("users")) || [];
const user = users.find(u => u.username === currentUser);

// format currency
function formatMoney(n){
  return "€" + Number(n).toLocaleString();
}

// update balance display
function updateBalance(){
  document.getElementById("balance").innerText =
  formatMoney(user.balance);
}

// toggle transfer box
function toggleSend(){
  const box=document.getElementById("sendBox");
  box.style.display = box.style.display==="block" ? "none":"block";
}

// send money
function sendMoney(){
  const name=document.getElementById("recipient").value.trim();
  const amount=Number(document.getElementById("amount").value);
  let date=document.getElementById("date").value;

  if(!name || !amount) return alert("Enter details");

  if(amount > user.balance)
    return alert("Insufficient balance");

  if(!date){
    date=new Date().toLocaleString();
  }

  // deduct balance
  user.balance -= amount;
  localStorage.setItem("users", JSON.stringify(users));

  // save history
  let history = JSON.parse(localStorage.getItem(currentUser+"_tx")) || [];

  history.push({name, amount, date});
  localStorage.setItem(currentUser+"_tx", JSON.stringify(history));

  updateBalance();
  alert("Transfer successful");

  recipient.value="";
  amount.value="";
  date.value="";
}

// show transaction history
function showHistory(){
  const historyBox=document.getElementById("history");
  historyBox.innerHTML="";

  const history = JSON.parse(localStorage.getItem(currentUser+"_tx")) || [];

  history.slice().reverse().forEach(tx=>{
    historyBox.innerHTML += `
      <div class="tx">
      €${tx.amount} → ${tx.name}<br>
      <small>${tx.date}</small>
      </div>`;
  });
}

// logout
function logout(){
  window.location.href="index.html";
}

updateBalance();
</script>

</body>
</html>
