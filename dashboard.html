<!-- ONLY the script section changed for safety -->
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBDp6wmJMY8WPyKPNE-bvVSiz4AIUbn71U",
  authDomain: "dechase-bank.firebaseapp.com",
  projectId: "dechase-bank"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let username = localStorage.getItem("loggedInUser");
if(!username) location.href="login.html";

username = username.toLowerCase();

let balanceVisible = true;
let realBalance = 0;

function toggleBalance(){
 balanceVisible = !balanceVisible;
 renderBalance();
}

function renderBalance(){
 document.getElementById("balance").innerText =
 balanceVisible ? "€"+realBalance.toLocaleString() : "••••••";
}

function addTransaction(note, amount){
 return {
   amount:Number(amount),
   note,
   date:new Date().toLocaleString(),
   ref:"TX-"+Math.floor(Math.random()*99999999)
 };
}

db.collection("users").doc(username)
.onSnapshot(doc=>{
 if(!doc.exists) return;

 const user=doc.data();
 document.getElementById("welcome").innerText =
   "Hello, "+(user.username || username);

 realBalance = Number(user.balance) || 0;
 renderBalance();

 const container=document.getElementById("transactions");
 container.innerHTML="";

 (user.transactions || [])
 .slice().reverse().slice(0,5)
 .forEach(tx=>{
   const cls = tx.amount < 0 ? "amountMinus":"amountPlus";
   container.innerHTML += `
   <div class="tx">
     <div>
       ${tx.note}
       <small>${tx.date}</small>
     </div>
     <div class="${cls}">€${Math.abs(tx.amount)}</div>
   </div>`;
 });
});

async function sendMoney(){
 const to = receiver.value.trim().toLowerCase();
 const amt = Number(amount.value);
 const desc = desc.value || "";

 if(!to || amt<=0) return alert("Enter valid details");
 if(to === username) return alert("Cannot send to yourself");

 const fromRef=db.collection("users").doc(username);
 const toRef=db.collection("users").doc(to);

 try{
 await db.runTransaction(async (t)=>{
   const fromDoc = await t.get(fromRef);
   const toDoc = await t.get(toRef);

   if(!toDoc.exists) throw "Receiver not found";

   const senderBal = Number(fromDoc.data().balance)||0;
   const recvBal = Number(toDoc.data().balance)||0;

   if(senderBal < amt) throw "Insufficient balance";

   t.update(fromRef,{
     balance: senderBal - amt,
     transactions: firebase.firestore.FieldValue.arrayUnion(
       addTransaction(`Sent to ${to} • ${desc}`, -amt)
     )
   });

   t.update(toRef,{
     balance: recvBal + amt,
     transactions: firebase.firestore.FieldValue.arrayUnion(
       addTransaction(`Received from ${username}`, amt)
     )
   });
 });

 alert("Transfer successful ✅");

 receiver.value="";
 amount.value="";
 desc.value="";

 }catch(err){
   alert(err);
 }
}
</script>