<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DeChase Bank</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:linear-gradient(160deg,#020617,#031427,#021a35);
  color:white;
}
.container{max-width:420px;margin:auto;padding:20px}

.card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(18px);
  border-radius:18px;
  padding:16px;
  margin-bottom:15px;
  border:1px solid rgba(255,255,255,0.05);
}

.balance-card{
  background:linear-gradient(135deg,#3aa0ff,#6ed0ff);
  border-radius:20px;
  padding:22px;
  text-align:center;
}

.balance{font-size:34px;font-weight:700;}
.eye{margin-top:6px;font-size:14px;cursor:pointer}

.bank-card{
  background:linear-gradient(135deg,#0d2b55,#081a35);
  border-radius:18px;
  padding:18px;
  margin-top:12px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin-top:10px;
}
.grid button{
  background:#0f2f55;
  border:none;
  border-radius:12px;
  padding:12px;
  color:white;
  font-weight:600;
}

input,textarea,select{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:none;
  font-size:15px;
}

button.primary{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:10px;
  background:#2d8cff;
  color:white;
  font-weight:600;
}

.tx{margin-top:10px}
.green{color:#00ffb2}
.red{color:#ff6b6b}

.badge{
  margin-top:6px;
  font-size:13px;
  color:#ffcc66;
}
</style>
</head>
<body>

<div class="container">

<h3 id="welcome"></h3>

<div class="balance-card">
  <div class="balance" id="balance">‚Ç¨0</div>
  <div class="eye" id="eyeToggle" onclick="toggleBalance()">üëÅ Hide balance</div>
</div>

<div class="bank-card">
  <div>DeChase Bank</div>
  <div id="cardName"></div>
</div>

<div class="card">
<b>Account Info</b><br>
Name: <span id="name"></span><br>
Account: <span id="acc"></span><br>
IBAN: <span id="iban"></span>
<div id="frozenBadge" class="badge"></div>
</div>

<div class="card">
<b>Quick Actions</b>
<div class="grid">
  <button onclick="showTransfer()">Send</button>
  <button onclick="alert('Pay Bills coming')">Pay Bills</button>
  <button onclick="alert('Gift Cards ready')">Gift Cards</button>
  <button onclick="alert('Card services soon')">Cards</button>
  <button onclick="alert('Withdraw coming')">Withdraw</button>
  <button onclick="alert('Deposit coming')">Deposit</button>
</div>
</div>

<div class="card" id="transferBox" style="display:none;">
<b>Send Money</b>
<input id="receiver" placeholder="Username OR IBAN">
<input id="amount" type="number" placeholder="Amount">
<input id="desc" placeholder="Description">
<button class="primary" onclick="askPin()">Send</button>
</div>

<div class="card">
<b>Support</b>
<select id="subject">
<option>Account Issue</option>
<option>Transfer Problem</option>
<option>Card Help</option>
<option>Other</option>
</select>
<textarea id="message" placeholder="Describe issue"></textarea>
<button class="primary" onclick="sendSupport()">Send Message</button>
<div id="supportHistory"></div>
</div>

<div class="card">
<b>Security</b>
<button class="primary" onclick="toggleFreeze()">Freeze / Unfreeze Account</button>
</div>

<div class="card">
<b>Transactions</b>
<div id="transactions"></div>
</div>

<button class="primary" onclick="logout()" style="background:#ff4d4d">Logout</button>

</div>

<!-- PIN MODAL -->
<div id="pinModal" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;">
<div style="background:#0a223d;padding:25px;border-radius:15px;width:85%;max-width:320px;text-align:center;">
<h3>Enter PIN</h3>
<input id="pinInput" type="password">
<button onclick="confirmTransfer()">Confirm</button>
<button onclick="closePin()" style="background:#555;margin-top:6px;">Cancel</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, addDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
 apiKey:"AIzaSyBDp6wmJMY8WPyKPNE-bvVSiz4AIUbn71U",
 authDomain:"dechase-bank.firebaseapp.com",
 projectId:"dechase-bank"
});
const db=getFirestore(app);

const username=localStorage.getItem("user");
if(!username) location.href="index.html";

const snap=await getDoc(doc(db,"users",username));
const data=snap.data();

welcome.innerText="Hello, "+data.fullName;
name.innerText=data.fullName;
acc.innerText=data.accountNumber;
iban.innerText=data.iban;
cardName.innerText=data.fullName;

if(data.frozen) frozenBadge.innerText="‚ö† Account Frozen";

let hidden=false;
function renderBalance(){
 balance.innerText=hidden?"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢":"‚Ç¨"+Number(data.balance).toLocaleString();
 eyeToggle.innerText=hidden?"üëÅ Show balance":"üëÅ Hide balance";
}
window.toggleBalance=()=>{hidden=!hidden;renderBalance();}
renderBalance();

window.showTransfer=()=> transferBox.style.display="block";

/* TRANSFER */
let transferData=null;
window.askPin=()=>{
 if(data.frozen) return alert("Account frozen");
 transferData={
   to:receiver.value,
   amt:parseFloat(amount.value),
   note:desc.value || "Transfer"
 };
 pinModal.style.display="flex";
};

window.closePin=()=> pinModal.style.display="none";

window.confirmTransfer=async()=>{
 if(pinInput.value!==data.pin) return alert("Wrong PIN");
 const users=await getDocs(collection(db,"users"));
 let rec=null, recData=null;
 users.forEach(d=>{
  if(d.id===transferData.to || d.data().iban===transferData.to){
    rec=d.id; recData=d.data();
  }
 });
 if(!rec) return alert("Receiver not found");
 if(data.balance<transferData.amt) return alert("Insufficient");

 const date=new Date().toLocaleString();
 const ref="DCB"+Math.floor(Math.random()*999999);

 await updateDoc(doc(db,"users",username),{
  balance:data.balance-transferData.amt,
  transactions:[...(data.transactions||[]),
  {amount:-transferData.amt,note:"Sent to "+rec,date,ref}]
 });

 await updateDoc(doc(db,"users",rec),{
  balance:Number(recData.balance)+transferData.amt,
  transactions:[...(recData.transactions||[]),
  {amount:transferData.amt,note:"Received from "+username,date,ref}]
 });

 localStorage.setItem("receipt",JSON.stringify({amount:transferData.amt,receiver:rec,date,ref}));
 location.href="receipt.html";
};

/* FREEZE */
window.toggleFreeze=async()=>{
 await updateDoc(doc(db,"users",username),{frozen:!data.frozen});
 location.reload();
};

/* SUPPORT */
window.sendSupport=async()=>{
 if(!message.value) return;
 await addDoc(collection(db,"support_messages"),{
  user:username,subject:subject.value,message:message.value,date:new Date().toLocaleString()
 });
 message.value="";
 alert("Message sent");
};

/* TX */
if(data.transactions){
 data.transactions.slice().reverse().forEach(tx=>{
  transactions.innerHTML+=`<div class="tx ${tx.amount>0?'green':'red'}">
  ${tx.note} (‚Ç¨${Math.abs(tx.amount)})
  </div>`;
 });
}

window.logout=()=>{
 localStorage.removeItem("user");
 location.href="index.html";
};
</script>
</body>
</html>