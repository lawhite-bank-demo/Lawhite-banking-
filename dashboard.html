<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DeChase Bank</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:linear-gradient(160deg,#020617,#031427,#021a35);
  color:white;
}
.container{max-width:420px;margin:auto;padding:20px;}

.card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(18px);
  border-radius:18px;
  padding:16px;
  margin-bottom:15px;
  border:1px solid rgba(255,255,255,0.06);
}

.balance-card{
  background:linear-gradient(135deg,#3aa0ff,#6ed0ff);
  border-radius:20px;
  padding:22px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,0.35);
}
.balance{font-size:34px;font-weight:700;}
.eye{margin-top:6px;font-size:14px;opacity:.9;cursor:pointer;}

.bank-card{
  background:linear-gradient(135deg,#0d2b55,#081a35);
  border-radius:18px;
  padding:18px;
  margin-top:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.4);
}
.bank-card-number{font-size:18px;letter-spacing:2px;margin-top:18px;}
.bank-card-name{margin-top:12px;font-size:14px;opacity:.85;}
.bank-card-bank{font-size:13px;opacity:.7;}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin-top:12px;
}
.grid button{
  background:#0f2f55;
  border:none;
  border-radius:14px;
  padding:14px 8px;
  color:white;
  font-size:13px;
  font-weight:600;
}

input, select, textarea{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:none;
  font-size:15px;
}

textarea{resize:none;height:80px;}

button.primary{
  width:100%;
  padding:14px;
  margin-top:10px;
  border-radius:12px;
  border:none;
  background:linear-gradient(135deg,#2d8cff,#5bbcff);
  color:white;
  font-weight:600;
}

.tx{margin-top:12px;}
.tx-date{font-size:11px;opacity:.6;}
.green{color:#00ffb2;}
.red{color:#ff6b6b;}
.small{font-size:12px;opacity:.7;}
</style>
</head>
<body>

<div class="container">

<h3 id="welcome"></h3>

<div class="balance-card">
  <div class="balance" id="balance">‚Ç¨0</div>
  <div class="eye" id="eyeToggle" onclick="toggleBalance()">üëÅ Hide balance</div>
</div>

<div class="bank-card">
  <div class="bank-card-bank">DeChase Bank</div>
  <div class="bank-card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 0001</div>
  <div class="bank-card-name" id="cardName"></div>
</div>

<div class="card">
<b>Account Info</b><br>
Name: <span id="name"></span><br>
Account: <span id="acc"></span><br>
IBAN: <span id="iban"></span>
</div>

<div class="card">
<b>Quick Actions</b>
<div class="grid">
  <button onclick="showTransfer()">Send</button>
  <button onclick="showSupport()">Support</button>
  <button onclick="buyGiftCard()">Gift Cards</button>
  <button onclick="alert('Card services coming')">Cards</button>
  <button onclick="alert('Withdraw coming')">Withdraw</button>
  <button onclick="alert('Deposit coming')">Deposit</button>
</div>
</div>

<div class="card" id="supportBox" style="display:none;">
<b>Contact Support</b>

<select id="subject">
  <option>Account Issue</option>
  <option>Transfer Problem</option>
  <option>Card Help</option>
  <option>Other</option>
</select>

<textarea id="message" placeholder="Describe your issue"></textarea>

<button class="primary" onclick="sendSupport()">Send Message</button>

<div id="supportHistory" class="small"></div>
</div>

<div class="card" id="transferBox" style="display:none;">
<b>Transfer Money</b>
<input id="receiver" placeholder="Username OR IBAN">
<input id="amount" type="number" placeholder="Amount">
<input id="desc" placeholder="Description">
<button class="primary" onclick="transfer()">Send</button>
</div>

<div class="card">
<b>Transactions</b>
<div id="transactions"></div>
</div>

<button class="primary" onclick="logout()" style="background:#ff4d4d;">Logout</button>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, doc, getDoc, updateDoc, collection, addDoc, getDocs
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBDp6wmJMY8WPyKPNE-bvVSiz4AIUbn71U",
  authDomain: "dechase-bank.firebaseapp.com",
  projectId: "dechase-bank"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const username = localStorage.getItem("user");
if(!username) location.href="index.html";

const snap = await getDoc(doc(db,"users",username));
const data = snap.data() || {};

document.getElementById("welcome").innerText="Hello, "+(data.fullName||"User");
document.getElementById("name").innerText=data.fullName||"-";
document.getElementById("acc").innerText=data.accountNumber||"-";
document.getElementById("iban").innerText=data.iban||"-";
document.getElementById("cardName").innerText=data.fullName||"";

const balanceValue = Number(data.balance || 0);

/* ‚úÖ PREMIUM BALANCE TOGGLE */
let hidden = localStorage.getItem("hideBalance") === "true";

function renderBalance(){
  document.getElementById("balance").innerText =
    hidden ? "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" : "‚Ç¨" + balanceValue.toLocaleString();

  document.getElementById("eyeToggle").innerText =
    hidden ? "üëÅ Show balance" : "üëÅ Hide balance";
}

window.toggleBalance = () => {
  hidden = !hidden;
  localStorage.setItem("hideBalance", hidden);
  renderBalance();
};

renderBalance();

window.showTransfer=()=>{transferBox.style.display="block";supportBox.style.display="none";}
window.showSupport=()=>{supportBox.style.display="block";transferBox.style.display="none";}
window.buyGiftCard=()=>alert("Gift card ready");

/* Transactions */
const txBox=document.getElementById("transactions");
if(data.transactions){
 data.transactions.slice().reverse().forEach(tx=>{
  const amt=Number(tx.amount||0);
  const color=amt>0?"green":"red";
  txBox.innerHTML+=`
  <div class="tx ${color}">
   ${tx.note||"Transfer"} (‚Ç¨${Math.abs(amt).toLocaleString()})
   <div class="tx-date">${tx.date||""}</div>
  </div>`;
 });
}

/* SUPPORT SYSTEM */
window.sendSupport = async ()=>{
 const subject=document.getElementById("subject").value;
 const message=document.getElementById("message").value.trim();
 if(!message) return alert("Enter message");

 await addDoc(collection(db,"support_messages"),{
   user: username,
   subject,
   message,
   status:"open",
   date:new Date().toLocaleString()
 });

 alert("Message sent. Support will respond shortly.");
 document.getElementById("message").value="";
 loadSupportHistory();
};

async function loadSupportHistory(){
 const snap=await getDocs(collection(db,"support_messages"));
 const box=document.getElementById("supportHistory");
 box.innerHTML="";
 snap.forEach(doc=>{
   const d=doc.data();
   if(d.user===username){
     box.innerHTML+=`<p>üì© ${d.subject}<br>${d.date}</p>`;
   }
 });
}
loadSupportHistory();

window.logout=()=>{
 localStorage.removeItem("user");
 location.href="index.html";
};
</script>

</body>
</html>