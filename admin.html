<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>

<style>
body{
  background:#0b1220;
  color:white;
  font-family:Arial;
  padding:20px;
}

h2{margin-bottom:15px;}

.card{
  background:#111827;
  padding:20px;
  border-radius:12px;
  margin-bottom:18px;
  box-shadow:0 6px 18px rgba(0,0,0,0.4);
}

input, select{
  width:100%;
  padding:12px;
  margin-top:8px;
  border:none;
  border-radius:8px;
  font-size:16px;
}

button{
  width:100%;
  padding:12px;
  margin-top:10px;
  background:#22c55e;
  border:none;
  color:white;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
}

button.delete{
  background:#ef4444;
}

.user{
  background:#1f2937;
  padding:12px;
  border-radius:10px;
  margin-top:10px;
  line-height:1.5;
}
.small{
  font-size:13px;
  color:#9ca3af;
}
</style>
</head>
<body>

<h2>Admin Control Panel</h2>

<div class="card">
  <h3>Create New User</h3>
  <input id="newUser" placeholder="Enter username">
  <button onclick="createUser()">Create User</button>
</div>

<div class="card">
  <h3>Send Demo Money</h3>
  <select id="userSelect"></select>
  <input type="number" id="amount" placeholder="Amount">
  <input type="date" id="date">
  <button onclick="sendMoney()">Send Money</button>
</div>

<div class="card">
  <h3>All Users</h3>
  <div id="users"></div>
</div>
<script src="recovery.js"></script>
<script>
// ✅ GLOBAL DATABASE KEY
let users = JSON.parse(localStorage.getItem("bankUsers")) || [];

// Save
function saveUsers(){
  localStorage.setItem("bankUsers", JSON.stringify(users));
}

// Generate account number
function generateAccount(){
  return Math.floor(1000000000 + Math.random() * 9000000000);
}

// Generate PIN
function generatePIN(){
  return Math.floor(1000 + Math.random() * 9000).toString();
}

// Create user
function createUser(){
  const name = document.getElementById("newUser").value.trim().toLowerCase();

  if(!name){
    alert("Enter username");
    return;
  }

  if(users.find(u => u.username === name)){
    alert("User already exists");
    return;
  }

  const newUser = {
    username: name,
    pin: generatePIN(),
    account: generateAccount(),
    balance: 0,
    transactions: []
  };

  users.push(newUser);
  saveUsers();
  loadUsers();

  alert(`User created!\nUsername: ${name}\nPIN: ${newUser.pin}`);
}

// Load users
function loadUsers(){
  const list = document.getElementById("users");
  const select = document.getElementById("userSelect");

  list.innerHTML="";
  select.innerHTML="";

  users.forEach(user => {

    list.innerHTML += `
      <div class="user">
        <strong>${user.username}</strong><br>
        <span class="small">Acct: ${user.account}</span><br>
        Balance: €${Number(user.balance).toLocaleString()}
        <br>
        <button class="delete" onclick="deleteUser('${user.username}')">Delete</button>
      </div>
    `;

    select.innerHTML += `<option value="${user.username}">${user.username}</option>`;
  });
}

// Delete user
function deleteUser(name){
  if(confirm("Delete this user?")){
    users = users.filter(u => u.username !== name);
    saveUsers();
    loadUsers();
  }
}

// Send money
function sendMoney(){
  const username = document.getElementById("userSelect").value;
  const amount = parseFloat(document.getElementById("amount").value);
  const date = document.getElementById("date").value || new Date().toLocaleDateString();

  if(!username || isNaN(amount) || amount <= 0){
    alert("Enter valid amount");
    return;
  }

  const user = users.find(u => u.username === username);

  user.balance += amount;

  user.transactions.unshift({
    name: "Admin Credit",
    amount: amount,
    date: date
  });

  saveUsers();
  loadUsers();
  alert("Money sent successfully");
}

// Load at start
loadUsers();
// auto backup
localStorage.setItem("backup_users", localStorage.getItem("users"));
</script>

</body>
</html>