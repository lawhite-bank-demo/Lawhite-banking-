<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>

<style>
body{
  background:#0b1220;
  color:white;
  font-family:Arial;
  padding:20px;
}

.card{
  background:#111827;
  padding:20px;
  border-radius:12px;
  margin-bottom:18px;
}

input, select{
  width:100%;
  padding:12px;
  margin-top:8px;
  border:none;
  border-radius:8px;
  font-size:16px;
}

button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
  background:#22c55e;
  color:white;
}

.delete{ background:#ef4444; }

.user{
  background:#1f2937;
  padding:12px;
  border-radius:10px;
  margin-top:10px;
}
.small{ font-size:13px; color:#9ca3af; }
</style>
</head>
<body>

<h2>Admin Control Panel</h2>

<!-- CREATE USER -->
<div class="card">
  <h3>Create New User</h3>
  <input id="newUser" placeholder="Username">
  <input id="newPin" placeholder="Create PIN (4 digits)">
  <button onclick="createUser()">Create User</button>
</div>

<!-- ADMIN TRANSFER -->
<div class="card">
  <h3>Admin Transfer / Credit</h3>

  <select id="userSelect"></select>

  <input type="number" id="amount" placeholder="Amount">

  <label style="font-size:13px;color:#9ca3af;margin-top:8px;display:block;">
    Transaction Date (Admin Controlled)
  </label>
  <input type="date" id="adminDate">

  <input id="note" placeholder="Reason (optional)">

  <button onclick="sendMoney()">Send Money</button>
</div>

<!-- USERS -->
<div class="card">
  <h3>All Users</h3>
  <div id="users"></div>
</div>

<script>

// LOAD USERS
let users = JSON.parse(localStorage.getItem("users")) || [];

// ENSURE ADMIN EXISTS
if(!users.find(u => u.username === "admin")){
  users.push({
    username:"admin",
    pin:"4321",
    account: generateAccount(),
    balance:15000,
    transactions:[]
  });
  saveUsers();
}

function saveUsers(){
  localStorage.setItem("users", JSON.stringify(users));
}

function generateAccount(){
  return Math.floor(1000000000 + Math.random() * 9000000000);
}

// CREATE USER
function createUser(){

  const name = newUser.value.trim().toLowerCase();
  const pin = newPin.value.trim();

  if(!name || !pin){
    alert("Enter username and PIN");
    return;
  }

  if(!/^\d{4,}$/.test(pin)){
    alert("PIN must be at least 4 numbers");
    return;
  }

  if(users.find(u => u.username === name)){
    alert("User already exists");
    return;
  }

  users.push({
    username:name,
    pin:pin,
    account:generateAccount(),
    balance:0,
    transactions:[]
  });

  saveUsers();
  loadUsers();

  newUser.value="";
  newPin.value="";
}

// LOAD USERS
function loadUsers(){

  const list = document.getElementById("users");
  const select = document.getElementById("userSelect");

  list.innerHTML="";
  select.innerHTML="";

  users.forEach(user => {

    list.innerHTML += `
      <div class="user">
        <strong>${user.username}</strong><br>
        <span class="small">Acct: ${user.account}</span><br>
        Balance: â‚¬${Number(user.balance).toLocaleString()}
        <br>
        ${user.username !== "admin"
          ? `<button class="delete" onclick="deleteUser('${user.username}')">Delete</button>`
          : "<span class='small'>Admin account protected</span>"}
      </div>
    `;

    if(user.username !== "admin"){
      select.innerHTML += `<option value="${user.username}">${user.username}</option>`;
    }
  });
}

// DELETE USER
function deleteUser(name){
  if(confirm("Delete this user permanently?")){
    users = users.filter(u => u.username !== name);
    saveUsers();
    loadUsers();
  }
}

// ADMIN CREDIT WITH BACKDATE
function sendMoney(){

  const username = userSelect.value;
  const amount = parseFloat(document.getElementById("amount").value);
  const noteText = note.value || "Admin Credit";

  if(!username || !amount || amount <= 0){
    alert("Enter valid amount");
    return;
  }

  const user = users.find(u => u.username === username);

  // format date
  const selectedDate = adminDate.value;
  const formattedDate = selectedDate
    ? new Date(selectedDate).toLocaleString()
    : new Date().toLocaleString();

  user.balance += amount;

  // save to user history
  user.transactions.unshift({
    name: noteText,
    amount: amount,
    date: formattedDate
  });

  // save global history
  let tx = JSON.parse(localStorage.getItem("transactions")) || [];

  tx.unshift({
    user: username,
    type: noteText,
    amount: amount,
    date: formattedDate
  });

  localStorage.setItem("transactions", JSON.stringify(tx));

  saveUsers();
  loadUsers();

  alert("Transaction recorded successfully");
}

loadUsers();

</script>
</body>
</html>