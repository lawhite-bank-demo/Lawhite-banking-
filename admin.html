<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel</title>

<style>
body{
  font-family: Arial;
  background:#0b1e35;
  color:white;
  text-align:center;
}
.card{
  background:#102a46;
  padding:20px;
  border-radius:12px;
  margin:20px;
}
input,button{
  width:90%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:none;
}
button{
  background:#2ecc71;
  color:white;
  font-size:16px;
}
.msg{
  margin-top:10px;
  color:#2ecc71;
}
.result{
  margin-top:10px;
  background:#0b1e35;
  padding:10px;
  border-radius:8px;
}
</style>
</head>
<body>

<h2>ðŸ‘‘ Admin Panel</h2>

<!-- LOGIN -->
<div class="card" id="loginCard">
  <h3>Admin Login</h3>
  <input id="adminUser" placeholder="Admin Username">
  <input id="adminPin" placeholder="Admin PIN">
  <button onclick="adminLogin()">Login</button>
</div>

<div id="panel" style="display:none">

<!-- CREATE USER -->
<div class="card">
  <h3>Create User</h3>
  <input id="newUser" placeholder="Username">
  <input id="newPin" placeholder="PIN">
  <input id="newBalance" placeholder="Starting Balance">
  <button onclick="createUser()">Create User</button>
</div>

<!-- CREDIT -->
<div class="card">
  <h3>Add Money</h3>
  <input id="creditUser" placeholder="Username">
  <input id="creditAmount" placeholder="Amount">
  <button onclick="addMoney()">Credit</button>
</div>

<!-- DEBIT -->
<div class="card">
  <h3>Deduct Money</h3>
  <input id="debitUser" placeholder="Username">
  <input id="debitAmount" placeholder="Amount">
  <button onclick="deductMoney()">Debit</button>
</div>

<div class="msg" id="msg"></div>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "dechase-bank.firebaseapp.com",
  projectId: "dechase-bank"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* LOGIN */
async function adminLogin(){
  const user = adminUser.value.trim().toLowerCase();
  const pin = adminPin.value.trim();

  const doc = await db.collection("users").doc(user).get();

  if(!doc.exists || doc.data().pin !== pin || doc.data().role !== "admin"){
    alert("Invalid admin login");
    return;
  }

  loginCard.style.display="none";
  panel.style.display="block";
}

/* HELPERS */
function generateAccount(){
  return "DCB-" + Math.floor(1000000 + Math.random()*9000000);
}

function generateCardNumber(){
  return "53" + Math.floor(1000000000000000 + Math.random()*9000000000000000);
}

function generateExpiry(){
  const year = new Date().getFullYear()+3;
  const month = String(Math.floor(Math.random()*12)+1).padStart(2,'0');
  return month + "/" + String(year).slice(2);
}

function generateCVV(){
  return Math.floor(100 + Math.random()*900).toString();
}

/* CREATE USER WITH CARD */
async function createUser(){

  const username = newUser.value.trim().toLowerCase();
  const pin = newPin.value.trim();
  const balance = Number(newBalance.value)||0;

  if(!username || !pin) return alert("Enter details");

  const exists = await db.collection("users").doc(username).get();
  if(exists.exists) return alert("User exists");

  const acc = generateAccount();
  const cardNumber = generateCardNumber();
  const expiry = generateExpiry();
  const cvv = generateCVV();

  await db.collection("users").doc(username).set({
    username,
    pin,
    balance,
    role:"user",
    accountNumber:acc,
    frozen:false,
    transactions:[],

    // ðŸ’³ CARD DETAILS
    cardNumber,
    expiry,
    cvv,
    cardStatus:"active"
  });

  msg.innerHTML = `
  âœ… User created<br>
  Account #: <b>${acc}</b><br>
  Card: <b>${cardNumber}</b><br>
  Exp: ${expiry} | CVV: ${cvv}
  `;
}

/* CREDIT */
async function addMoney(){
  const user = creditUser.value.trim().toLowerCase();
  const amount = Number(creditAmount.value);
  if(amount<=0) return alert("Enter valid amount");

  const ref = db.collection("users").doc(user);
  const doc = await ref.get();
  if(!doc.exists) return alert("User not found");

  await ref.update({
    balance:(doc.data().balance||0)+amount
  });

  msg.innerText="âœ… Money credited";
}

/* DEBIT */
async function deductMoney(){
  const user = debitUser.value.trim().toLowerCase();
  const amount = Number(debitAmount.value);
  if(amount<=0) return alert("Enter valid amount");

  const ref = db.collection("users").doc(user);
  const doc = await ref.get();
  if(!doc.exists) return alert("User not found");

  if(doc.data().balance < amount)
    return alert("Insufficient funds");

  await ref.update({
    balance:doc.data().balance - amount
  });

  msg.innerText="âœ… Money deducted";
}
</script>
</body>
</html>