<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>

<style>
body{
  background:#0b1220;
  color:white;
  font-family:Arial;
  padding:20px;
}

.card{
  background:#111827;
  padding:20px;
  border-radius:12px;
  margin-bottom:18px;
}

input, select{
  width:100%;
  padding:12px;
  margin-top:8px;
  border:none;
  border-radius:8px;
  font-size:16px;
}

button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
  background:#22c55e;
  color:white;
}

.delete{ background:#ef4444; }

.user{
  background:#1f2937;
  padding:12px;
  border-radius:10px;
  margin-top:10px;
  line-height:1.5;
}
.small{ font-size:13px; color:#9ca3af; }
</style>
</head>
<body>

<h2>Admin Control Panel</h2>

<!-- CREATE USER -->
<div class="card">
  <h3>Create New User</h3>
  <input id="newUser" placeholder="Username">
  <input id="newPin" placeholder="Create PIN (4 digits)">
  <button onclick="createUser()">Create User</button>
</div>

<!-- SEND MONEY -->
<div class="card">
  <h3>Send Money</h3>
  <select id="userSelect"></select>
  <input type="number" id="amount" placeholder="Amount">
  <button onclick="sendMoney()">Send Money</button>
</div>

<!-- USERS LIST -->
<div class="card">
  <h3>All Users</h3>
  <div id="users"></div>
</div>

<script>

// LOAD USERS
let users = JSON.parse(localStorage.getItem("users")) || [];

// CREATE DEFAULT ADMIN IF NONE EXISTS
if(!users.find(u => u.username === "admin")){
  users.push({
    username:"admin",
    pin:"4321",
    account: generateAccount(),
    balance:15000,
    transactions:[]
  });
  saveUsers();
}

// SAVE USERS
function saveUsers(){
  localStorage.setItem("users", JSON.stringify(users));
}

// GENERATE ACCOUNT NUMBER
function generateAccount(){
  return Math.floor(1000000000 + Math.random() * 9000000000);
}

// CREATE USER
function createUser(){

  const name = document.getElementById("newUser").value.trim().toLowerCase();
  const pin = document.getElementById("newPin").value.trim();

  if(!name || !pin){
    alert("Enter username and PIN");
    return;
  }

  if(!/^\d{4,}$/.test(pin)){
    alert("PIN must be at least 4 numbers");
    return;
  }

  if(users.find(u => u.username === name)){
    alert("User already exists");
    return;
  }

  const newUser = {
    username: name,
    pin: pin,
    account: generateAccount(),
    balance: 0,
    transactions: []
  };

  users.push(newUser);
  saveUsers();
  loadUsers();

  document.getElementById("newUser").value="";
  document.getElementById("newPin").value="";

  alert("User created successfully");
}

// LOAD USERS
function loadUsers(){
  const list = document.getElementById("users");
  const select = document.getElementById("userSelect");

  list.innerHTML="";
  select.innerHTML="";

  users.forEach(user => {

    list.innerHTML += `
      <div class="user">
        <strong>${user.username}</strong><br>
        <span class="small">Acct: ${user.account}</span><br>
        Balance: â‚¬${Number(user.balance).toLocaleString()}
        <br>
        ${user.username !== "admin" ? 
          `<button class="delete" onclick="deleteUser('${user.username}')">Delete</button>`
          : "<span class='small'>Admin account protected</span>"}
      </div>
    `;

    if(user.username !== "admin"){
      select.innerHTML += `<option value="${user.username}">${user.username}</option>`;
    }
  });
}

// DELETE USER
function deleteUser(name){

  if(confirm("Delete this user permanently?")){
    users = users.filter(u => u.username !== name);
    saveUsers();
    loadUsers();
  }
}

// SEND MONEY
function sendMoney(){

  const username = document.getElementById("userSelect").value;
  const amount = parseFloat(document.getElementById("amount").value);

  if(!username || !amount || amount <= 0){
    alert("Enter valid amount");
    return;
  }

  const user = users.find(u => u.username === username);

  user.balance += amount;

  user.transactions.unshift({
    name:"Admin Credit",
    amount:amount,
    date:new Date().toLocaleString()
  });

  saveUsers();
  loadUsers();

  alert("Money sent successfully");
}

// LOAD USERS ON START
loadUsers();

</script>

</body>
</html>