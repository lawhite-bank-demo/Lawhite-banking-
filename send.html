<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Send Money</title>
<style>
body{
 background:#061a2f;color:white;font-family:Arial;
 display:flex;justify-content:center;align-items:center;height:100vh;
}
.card{background:#0d2b4d;padding:25px;border-radius:14px;width:320px;}
input{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:none;}
button{width:100%;padding:12px;margin-top:15px;border:none;border-radius:8px;background:#1e88e5;color:white;}
</style>
</head>
<body>

<div class="card">
<h2>Send Money</h2>
<input id="receiver" placeholder="Recipient Username">
<input id="amount" type="number" placeholder="Amount">
<button onclick="sendMoney()">Send</button>
<p id="msg"></p>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
const firebaseConfig={
 apiKey:"AIzaSyBDp6wmJMY8WPyKPNE-bvVSiz4AIUbn71U",
 authDomain:"dechase-bank.firebaseapp.com",
 projectId:"dechase-bank"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let username=localStorage.getItem("loggedInUser");
username=username.toLowerCase();

async function sendMoney(){
 const to=document.getElementById("receiver").value.toLowerCase();
 const amt=Number(document.getElementById("amount").value);

 if(!to||amt<=0) return;

 const fromRef=db.collection("users").doc(username);
 const toRef=db.collection("users").doc(to);

 try{
 await db.runTransaction(async t=>{
   const fromDoc=await t.get(fromRef);
   const toDoc=await t.get(toRef);

   if(!toDoc.exists) throw "User not found";

   const senderBal=fromDoc.data().balance||0;
   if(senderBal<amt) throw "Insufficient balance";

   t.update(fromRef,{balance:senderBal-amt});
   t.update(toRef,{balance:(toDoc.data().balance||0)+amt});
 });

 document.getElementById("msg").innerText="Sent successfully";

 }catch(err){
  document.getElementById("msg").innerText=err;
 }
}
</script>
</body>
</html>