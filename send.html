<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Send Money</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#061a2f;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.card{
  background:#0d2b4d;
  padding:25px;
  border-radius:14px;
  width:320px;
}

input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:none;
}

button{
  width:100%;
  padding:12px;
  margin-top:15px;
  border:none;
  border-radius:8px;
  background:#1e88e5;
  color:white;
  font-size:16px;
}
</style>
</head>
<body>

<div class="card">
  <h2>Send Money</h2>

  <input type="text" id="receiver" placeholder="Recipient Username">
  <input type="number" id="amount" placeholder="Amount">

  <button onclick="sendMoney()">Send</button>
  <button onclick="goBack()">Back</button>

  <p id="msg"></p>
</div>

<script>
function sendMoney(){

  const receiverName = document.getElementById("receiver").value.toLowerCase();
  const amount = parseFloat(document.getElementById("amount").value);

  const users = JSON.parse(localStorage.getItem("bankUsers"));
  let sender = JSON.parse(localStorage.getItem("loggedInUser"));

  const receiver = users.find(u => u.username === receiverName);

  if(!receiver){
    document.getElementById("msg").innerText = "User not found";
    return;
  }

  if(amount <= 0 || amount > sender.balance){
    document.getElementById("msg").innerText = "Invalid amount";
    return;
  }

  // ensure arrays exist
  if(!sender.transactions) sender.transactions = [];
  if(!receiver.transactions) receiver.transactions = [];

  // update balances
  sender.balance -= amount;
  receiver.balance += amount;

  // store transactions
  sender.transactions.push({
    amount: -amount,
    note: "Transfer to " + receiver.username,
    date: new Date().toLocaleDateString()
  });

  receiver.transactions.push({
    amount: amount,
    note: "Transfer from " + sender.username,
    date: new Date().toLocaleDateString()
  });

  // save users
  const updatedUsers = users.map(u =>
    u.username === sender.username ? sender :
    u.username === receiver.username ? receiver : u
  );

  localStorage.setItem("bankUsers", JSON.stringify(updatedUsers));
  localStorage.setItem("loggedInUser", JSON.stringify(sender));

  document.getElementById("msg").innerText = "Transfer successful";

  setTimeout(()=>{
    window.location.href = "Dashboard.html";
  },1000);
}

function goBack(){
  window.location.href = "Dashboard.html";
}
</script>

</body>
</html>
